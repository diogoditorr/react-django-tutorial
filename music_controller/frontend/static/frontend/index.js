import{j as N,R as L,r as n,u as j,a as A,G as t,T as v,F as O,b as E,c as M,d as q,e as F,f as V,B as u,L as G,g as K,C as Q,I as D,P as W,h as Y,S as Z,i as ee,k as U,l as te,A as J,m as oe,n as ne,o as b,p as re}from"./assets/vendor.7327175a.js";const e=N.exports.jsx,r=N.exports.jsxs,se=N.exports.Fragment,I=L.createContext({});function ae(o){const[a,i]=n.exports.useState(""),[s,f]=n.exports.useState({votesToSkip:2,guestCanPause:!0});async function C(y){const d=await fetch("/api/get-room?code="+y);return{data:await d.json(),response:d}}return e(I.Provider,{value:{defaultRoomProps:s,roomCode:a,getRoom:C,setRoomCode:i},children:o.children})}function ie(){const o=j(),{setRoomCode:a,defaultRoomProps:i}=n.exports.useContext(I),[s,f,C]=A(["csrftoken"]),[y,d]=n.exports.useState(i.guestCanPause),[h,S]=n.exports.useState(i.votesToSkip);function l(k){S(Number(k.target.value))}function g(k){d(k.target.value==="true")}function x(){const k={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrftoken},body:JSON.stringify({votes_to_skip:h,guest_can_pause:y})};fetch("/api/create-room",k).then(m=>m.json()).then(m=>{m.code===null?o.push("/"):(a(m.code),o.push("/room/"+m.code))})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(v,{component:"h4",variant:"h4",children:"Create a Room"})}),e(t,{item:!0,xs:12,children:r(O,{component:"fieldset",children:[e(E,{children:e("span",{children:"Guest Control of Playback State"})}),r(M,{row:!0,defaultValue:i.guestCanPause.toString(),onChange:g,children:[e(q,{value:"true",control:e(F,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(q,{value:"false",control:e(F,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(O,{children:[e(V,{required:!0,type:"number",defaultValue:h,inputProps:{min:1,style:{textAlign:"center"}},onChange:l}),e(E,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(u,{color:"primary",variant:"contained",onClick:x,children:"Create A Room"})}),e(t,{item:!0,xs:12,children:e(u,{color:"secondary",variant:"contained",to:"/",component:G,children:"Back"})})]})]})}function ce(){const{roomCode:o,setRoomCode:a}=n.exports.useContext(I),i=j();return n.exports.useEffect(()=>{console.log("Room Code:",o),o?i.push("/room/"+o):fetch("/api/user-in-room").then(s=>s.json()).then(s=>{s.code!==null&&(a(s.code),i.push("/room/"+s.code))})},[]),r(t,{container:!0,spacing:3,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(v,{variant:"h3",children:"House Party"})}),e(t,{item:!0,xs:12,alignItems:"center",children:r(K,{disableElevation:!0,variant:"contained",color:"primary",children:[e(u,{color:"primary",to:"/join",component:G,children:"Join a Room"}),e(u,{color:"secondary",to:"/create",component:G,children:"Create a Room"})]})})]})}function le(o){function a(){return o.song.time/o.song.duration*100}async function i(){await fetch("/spotify/pause",{method:"PUT",headers:{"Content-Type":"application/json"}})}async function s(){await fetch("/spotify/play",{method:"PUT",headers:{"Content-Type":"application/json"}})}async function f(){await fetch("/spotify/skip",{method:"POST",headers:{"Content-Type":"application/json"}})}return r(Q,{children:[r(t,{container:!0,alignItems:"center",children:[e(t,{item:!0,xs:4,children:e("img",{src:o.song.image_url,height:"100%",width:"100%",alt:""})}),r(t,{item:!0,xs:8,children:[e(v,{component:"h5",variant:"h5",align:"center",children:o.song.title}),e(v,{color:"textSecondary",variant:"subtitle1",align:"center",children:o.song.artist}),r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e(D,{onClick:()=>o.song.is_playing?i():s(),children:o.song.is_playing?e(W,{}):e(Y,{})}),e(D,{onClick:()=>f(),children:e(Z,{})}),r("p",{children:[o.song.votes+" "," / ",o.song.votes_required]})]})]})]}),e(ee,{variant:"determinate",value:a()})]})}function ue(){const o=j(),{roomCode:a}=U(),{setRoomCode:i,getRoom:s}=n.exports.useContext(I),[f,C,y]=A(["csrftoken"]),[d,h]=n.exports.useState(2),[S,l]=n.exports.useState(!1),[g,x]=n.exports.useState(!1),[k,m]=n.exports.useState(!1),[w,B]=n.exports.useState({}),[R,p]=n.exports.useState(!1);function P(){fetch("/api/leave-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":f.csrftoken}}).then(c=>{H(),o.push("/")})}function H(){i("")}async function X(){let c=await fetch("/spotify/is-authenticated");const T=await c.json();if(T.status===!1){c=await fetch("/spotify/get-auth-url");const _=await c.json();window.location.replace(_.url)}m(T.status)}async function $(){const c=await fetch("/spotify/current-song");return c.ok?await c.json():{}}async function z(){const c=await s(a);c.response.status!==200&&(H(),o.push("/")),h(c.data.votes_to_skip),l(c.data.guest_can_pause),x(c.data.is_host),i(a)}return n.exports.useEffect(()=>{z()},[]),n.exports.useEffect(()=>{g&&X()},[g]),n.exports.useEffect(()=>{if(R)return;let c=0;const T=setInterval(async()=>{const _=await $();B(_),Object.keys(_).length<1&&c<3&&c++,c>=3&&(clearInterval(T),p(!0))},3e3);return()=>clearInterval(T)},[R]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(v,{variant:"h4",component:"h4",children:["Code: ",a]})}),Object.keys(w).length>0&&e(le,{song:w}),R&&r(se,{children:[e(v,{variant:"h5",component:"h5",children:"Could not get current song. Please try again in a minute."}),e(u,{variant:"contained",color:"primary",onClick:()=>p(!1),children:"Try again"})]}),g?e(t,{item:!0,xs:12,children:e(u,{variant:"contained",color:"primary",onClick:()=>o.push(`/room/${a}/settings`),children:"Settings"})}):"",e(t,{item:!0,xs:12,children:e(u,{variant:"contained",color:"secondary",onClick:P,children:"Leave Room"})})]})}function de(){const o=j(),[a,i]=n.exports.useState(""),[s,f,C]=A(["csrftoken"]),[y,d]=n.exports.useState("");function h(l){i(l.target.value)}function S(){fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrftoken},body:JSON.stringify({code:a})}).then(l=>{l.ok?o.push(`/room/${a}`):d("Room not found.")}).catch(l=>{console.log(l)})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(v,{variant:"h4",component:"h4",children:"Join a Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(V,{error:!!y,label:"Code",placeholder:"Enter a Room Code",value:a,helperText:y,variant:"outlined",onChange:h})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(u,{variant:"contained",color:"primary",onClick:S,children:"Enter Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(u,{variant:"contained",color:"secondary",to:"/",component:G,children:"Back"})})]})}function he(){const o=j(),{getRoom:a,defaultRoomProps:i}=n.exports.useContext(I),{roomCode:s}=U(),[f,C,y]=A(["csrftoken"]),[d,h]=n.exports.useState(i.guestCanPause),[S,l]=n.exports.useState(i.votesToSkip),[g,x]=n.exports.useState(""),[k,m]=n.exports.useState(!1);function w(p){l(Number(p.target.value))}function B(p){h(p.target.value==="true")}function R(){const p={method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":f.csrftoken},body:JSON.stringify({votes_to_skip:S,guest_can_pause:d,code:s})};fetch("/api/update-room",p).then(P=>{P.ok?(m(!1),x("Room updated successfully!")):(m(!0),x("Error updating room..."))})}return n.exports.useEffect(()=>{async function p(){const P=await a(s);P.response.status!==200&&o.push("/"),h(P.data.guest_can_pause),l(P.data.votes_to_skip)}p()},[]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(te,{in:g!="",children:k===!0?e(J,{severity:"error",onClose:()=>x(""),children:g}):e(J,{severity:"success",onClose:()=>x(""),children:g})})}),e(t,{item:!0,xs:12,children:e(v,{component:"h4",variant:"h4",children:"Update Room"})}),e(t,{item:!0,xs:12,children:r(O,{component:"fieldset",children:[e(E,{children:e("span",{children:"Guest Control of Playback State"})}),r(M,{row:!0,value:d.toString(),onChange:B,children:[e(q,{value:"true",control:e(F,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(q,{value:"false",control:e(F,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(O,{children:[e(V,{required:!0,type:"number",value:S,inputProps:{min:1,style:{textAlign:"center"}},onChange:w}),e(E,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),e(t,{item:!0,xs:12,children:e(u,{color:"primary",variant:"contained",onClick:R,children:"Update Room"})})]})}),e(t,{item:!0,xs:12,children:e(u,{variant:"contained",color:"secondary",onClick:()=>o.push(`/room/${s}`),children:"Go back"})})]})}function me(){return e("div",{className:"center",children:e(ae,{children:e(oe,{children:r(ne,{children:[e(b,{path:"/",exact:!0,component:ce}),e(b,{path:"/join",component:de}),e(b,{path:"/create",component:ie}),e(b,{path:"/room/:roomCode",exact:!0,component:ue}),e(b,{path:"/room/:roomCode/settings",component:he})]})})})})}re.render(e(L.StrictMode,{children:e(me,{})}),document.getElementById("app"));
