import{j as q,R as D,r as n,u as T,a as B,G as t,T as k,F as j,b as w,c as J,d as _,e as A,f as O,B as p,L as G,g as $,C as z,I as V,P as K,h as Q,S as W,i as Y,k as L,l as Z,A as H,m as ee,n as te,o as P,p as oe}from"./assets/vendor.7327175a.js";const e=q.exports.jsx,r=q.exports.jsxs,b=D.createContext({});function ne(o){const[s,i]=n.exports.useState(""),[a,S]=n.exports.useState({votesToSkip:2,guestCanPause:!0});async function R(f){const u=await fetch("/api/get-room?code="+f);return{data:await u.json(),response:u}}return e(b.Provider,{value:{defaultRoomProps:a,roomCode:s,getRoom:R,setRoomCode:i},children:o.children})}function re(){const o=T(),{setRoomCode:s,defaultRoomProps:i}=n.exports.useContext(b),[a,S,R]=B(["csrftoken"]),[f,u]=n.exports.useState(i.guestCanPause),[d,y]=n.exports.useState(i.votesToSkip);function l(x){y(Number(x.target.value))}function g(x){u(x.target.value==="true")}function C(){const x={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a.csrftoken},body:JSON.stringify({votes_to_skip:d,guest_can_pause:f})};fetch("/api/create-room",x).then(h=>h.json()).then(h=>{h.code===null?o.push("/"):(s(h.code),o.push("/room/"+h.code))})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(k,{component:"h4",variant:"h4",children:"Create a Room"})}),e(t,{item:!0,xs:12,children:r(j,{component:"fieldset",children:[e(w,{children:e("span",{children:"Guest Control of Playback State"})}),r(J,{row:!0,defaultValue:i.guestCanPause.toString(),onChange:g,children:[e(_,{value:"true",control:e(A,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(_,{value:"false",control:e(A,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(j,{children:[e(O,{required:!0,type:"number",defaultValue:d,inputProps:{min:1,style:{textAlign:"center"}},onChange:l}),e(w,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(p,{color:"primary",variant:"contained",onClick:C,children:"Create A Room"})}),e(t,{item:!0,xs:12,children:e(p,{color:"secondary",variant:"contained",to:"/",component:G,children:"Back"})})]})]})}function se(){const{roomCode:o,setRoomCode:s}=n.exports.useContext(b),i=T();return n.exports.useEffect(()=>{console.log("Room Code:",o),o?i.push("/room/"+o):fetch("/api/user-in-room").then(a=>a.json()).then(a=>{a.code!==null&&(s(a.code),i.push("/room/"+a.code))})},[]),r(t,{container:!0,spacing:3,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(k,{variant:"h3",children:"House Party"})}),e(t,{item:!0,xs:12,alignItems:"center",children:r($,{disableElevation:!0,variant:"contained",color:"primary",children:[e(p,{color:"primary",to:"/join",component:G,children:"Join a Room"}),e(p,{color:"secondary",to:"/create",component:G,children:"Create a Room"})]})})]})}function ae(o){function s(){return o.song.time/o.song.duration*100}return r(z,{children:[r(t,{container:!0,alignItems:"center",children:[e(t,{item:!0,xs:4,children:e("img",{src:o.song.image_url,height:"100%",width:"100%",alt:""})}),r(t,{item:!0,xs:8,children:[e(k,{component:"h5",variant:"h5",align:"center",children:o.song.title}),e(k,{color:"textSecondary",variant:"subtitle1",align:"center",children:o.song.artist}),r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e(V,{children:o.song.is_playing?e(K,{}):e(Q,{})}),e(V,{children:e(W,{})})]})]})]}),e(Y,{variant:"determinate",value:s()})]})}function ie(){const o=T(),{roomCode:s}=L(),{setRoomCode:i,getRoom:a}=n.exports.useContext(b),[S,R,f]=B(["csrftoken"]),[u,d]=n.exports.useState(2),[y,l]=n.exports.useState(!1),[g,C]=n.exports.useState(!1),[x,h]=n.exports.useState(!1),[I,E]=n.exports.useState({});function F(){fetch("/api/leave-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":S.csrftoken}}).then(c=>{m(),o.push("/")})}function m(){i("")}async function v(){let c=await fetch("/spotify/is-authenticated");const N=await c.json();if(N.status===!1){c=await fetch("/spotify/get-auth-url");const U=await c.json();window.location.replace(U.url)}h(N.status)}async function M(){const c=await fetch("/spotify/current-song");return c.ok?await c.json():{}}async function X(){const c=await a(s);c.response.status!==200&&(m(),o.push("/")),d(c.data.votes_to_skip),l(c.data.guest_can_pause),C(c.data.is_host),i(s)}return n.exports.useEffect(()=>{X()},[]),n.exports.useEffect(()=>{if(g){v();const c=setInterval(async()=>{E(await M())},3e3);return()=>clearInterval(c)}},[g]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(k,{variant:"h4",component:"h4",children:["Code: ",s]})}),Object.keys(I).length>0&&e(ae,{song:I}),g?e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"primary",onClick:()=>o.push(`/room/${s}/settings`),children:"Settings"})}):"",e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"secondary",onClick:F,children:"Leave Room"})})]})}function ce(){const o=T(),[s,i]=n.exports.useState(""),[a,S,R]=B(["csrftoken"]),[f,u]=n.exports.useState("");function d(l){i(l.target.value)}function y(){fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a.csrftoken},body:JSON.stringify({code:s})}).then(l=>{l.ok?o.push(`/room/${s}`):u("Room not found.")}).catch(l=>{console.log(l)})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(k,{variant:"h4",component:"h4",children:"Join a Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(O,{error:!!f,label:"Code",placeholder:"Enter a Room Code",value:s,helperText:f,variant:"outlined",onChange:d})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(p,{variant:"contained",color:"primary",onClick:y,children:"Enter Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(p,{variant:"contained",color:"secondary",to:"/",component:G,children:"Back"})})]})}function le(){const o=T(),{getRoom:s,defaultRoomProps:i}=n.exports.useContext(b),{roomCode:a}=L(),[S,R,f]=B(["csrftoken"]),[u,d]=n.exports.useState(i.guestCanPause),[y,l]=n.exports.useState(i.votesToSkip),[g,C]=n.exports.useState(""),[x,h]=n.exports.useState(!1);function I(m){l(Number(m.target.value))}function E(m){d(m.target.value==="true")}function F(){const m={method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":S.csrftoken},body:JSON.stringify({votes_to_skip:y,guest_can_pause:u,code:a})};fetch("/api/update-room",m).then(v=>{v.ok?(h(!1),C("Room updated successfully!")):(h(!0),C("Error updating room..."))})}return n.exports.useEffect(()=>{async function m(){const v=await s(a);v.response.status!==200&&o.push("/"),d(v.data.guest_can_pause),l(v.data.votes_to_skip)}m()},[]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(Z,{in:g!="",children:x===!0?e(H,{severity:"error",onClose:()=>C(""),children:g}):e(H,{severity:"success",onClose:()=>C(""),children:g})})}),e(t,{item:!0,xs:12,children:e(k,{component:"h4",variant:"h4",children:"Update Room"})}),e(t,{item:!0,xs:12,children:r(j,{component:"fieldset",children:[e(w,{children:e("span",{children:"Guest Control of Playback State"})}),r(J,{row:!0,value:u.toString(),onChange:E,children:[e(_,{value:"true",control:e(A,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(_,{value:"false",control:e(A,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(j,{children:[e(O,{required:!0,type:"number",value:y,inputProps:{min:1,style:{textAlign:"center"}},onChange:I}),e(w,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),e(t,{item:!0,xs:12,children:e(p,{color:"primary",variant:"contained",onClick:F,children:"Update Room"})})]})}),e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"secondary",onClick:()=>o.push(`/room/${a}`),children:"Go back"})})]})}function ue(){return e("div",{className:"center",children:e(ne,{children:e(ee,{children:r(te,{children:[e(P,{path:"/",exact:!0,component:se}),e(P,{path:"/join",component:ce}),e(P,{path:"/create",component:re}),e(P,{path:"/room/:roomCode",exact:!0,component:ie}),e(P,{path:"/room/:roomCode/settings",component:le})]})})})})}oe.render(e(D.StrictMode,{children:e(ue,{})}),document.getElementById("app"));
