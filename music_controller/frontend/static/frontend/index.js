import{j as V,R as M,r as n,u as E,a as F,G as t,T as g,F as N,b as A,c as U,d as q,e as B,f as H,B as l,L as I,g as K,C as Q,I as J,P as Y,h as Z,S as ee,i as te,k as X,l as oe,A as L,N as ne,m as re,n as se,o as ae,p as R,q as ie}from"./assets/vendor.af228c4c.js";const e=V.exports.jsx,r=V.exports.jsxs,ce=V.exports.Fragment,w=M.createContext({});function le(o){const[s,i]=n.exports.useState(""),[a,C]=n.exports.useState({votesToSkip:2,guestCanPause:!0});async function y(x){const d=await fetch("/api/get-room?code="+x);return{data:await d.json(),response:d}}return e(w.Provider,{value:{defaultRoomProps:a,roomCode:s,getRoom:y,setRoomCode:i},children:o.children})}function ue(){const o=E(),{setRoomCode:s,defaultRoomProps:i}=n.exports.useContext(w),[a,C,y]=F(["csrftoken"]),[x,d]=n.exports.useState(i.guestCanPause),[h,S]=n.exports.useState(i.votesToSkip);function u(k){S(Number(k.target.value))}function f(k){d(k.target.value==="true")}function v(){const k={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a.csrftoken},body:JSON.stringify({votes_to_skip:h,guest_can_pause:x})};fetch("/api/create-room",k).then(p=>p.json()).then(p=>{p.code===null?o.push("/"):(s(p.code),o.push("/room/"+p.code))})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(g,{component:"h4",variant:"h4",children:"Create a Room"})}),e(t,{item:!0,xs:12,children:r(N,{component:"fieldset",children:[e(A,{children:e("span",{children:"Guest Control of Playback State"})}),r(U,{row:!0,defaultValue:i.guestCanPause.toString(),onChange:f,children:[e(q,{value:"true",control:e(B,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(q,{value:"false",control:e(B,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(N,{children:[e(H,{required:!0,type:"number",defaultValue:h,inputProps:{min:1,style:{textAlign:"center"}},onChange:u}),e(A,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(l,{color:"primary",variant:"contained",onClick:v,children:"Create A Room"})}),e(t,{item:!0,xs:12,children:e(l,{color:"secondary",variant:"contained",to:"/",component:I,children:"Back"})})]})]})}function de(){const{roomCode:o,setRoomCode:s}=n.exports.useContext(w),i=E();return n.exports.useEffect(()=>{o?i.push("/room/"+o):fetch("/api/user-in-room").then(a=>a.json()).then(a=>{a.code!==null&&(s(a.code),i.push("/room/"+a.code))})},[]),r(t,{container:!0,spacing:3,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(g,{variant:"h3",children:"House Party"})}),e(t,{item:!0,xs:12,alignItems:"center",children:r(K,{disableElevation:!0,variant:"contained",color:"primary",children:[e(l,{color:"primary",to:"/join",component:I,children:"Join a Room"}),e(l,{color:"default",to:"/info",component:I,children:"Info"}),e(l,{color:"secondary",to:"/create",component:I,children:"Create a Room"})]})})]})}function he(o){function s(){return o.song.time/o.song.duration*100}async function i(){await fetch("/spotify/pause",{method:"PUT",headers:{"Content-Type":"application/json"}})}async function a(){await fetch("/spotify/play",{method:"PUT",headers:{"Content-Type":"application/json"}})}async function C(){await fetch("/spotify/skip",{method:"POST",headers:{"Content-Type":"application/json"}})}return r(Q,{children:[r(t,{container:!0,alignItems:"center",children:[e(t,{item:!0,xs:4,children:e("img",{src:o.song.image_url,height:"100%",width:"100%",alt:""})}),r(t,{item:!0,xs:8,children:[e(g,{component:"h5",variant:"h5",align:"center",children:o.song.title}),e(g,{color:"textSecondary",variant:"subtitle1",align:"center",children:o.song.artist}),r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e(J,{onClick:()=>o.song.is_playing?i():a(),children:o.song.is_playing?e(Y,{}):e(Z,{})}),e(J,{onClick:()=>C(),children:e(ee,{})}),r("p",{children:[o.song.votes+" "," / ",o.song.votes_required]})]})]})]}),e(te,{variant:"determinate",value:s()})]})}function pe(){const o=E(),{roomCode:s}=X(),{setRoomCode:i,getRoom:a}=n.exports.useContext(w),[C,y,x]=F(["csrftoken"]),[d,h]=n.exports.useState(2),[S,u]=n.exports.useState(!1),[f,v]=n.exports.useState(!1),[k,p]=n.exports.useState(!1),[O,G]=n.exports.useState({}),[j,m]=n.exports.useState(!1);function P(){fetch("/api/leave-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":C.csrftoken}}).then(c=>{D(),o.push("/")})}function D(){i("")}async function $(){let c=await fetch("/spotify/is-authenticated");const b=await c.json();if(b.status===!1){c=await fetch("/spotify/get-auth-url");const _=await c.json();window.location.replace(_.url)}p(b.status)}async function W(){const c=await fetch("/spotify/current-song");return c.ok?await c.json():{}}async function z(){const c=await a(s);c.response.status!==200&&(D(),o.push("/")),h(c.data.votes_to_skip),u(c.data.guest_can_pause),v(c.data.is_host),i(s)}return n.exports.useEffect(()=>{z()},[]),n.exports.useEffect(()=>{f&&$()},[f]),n.exports.useEffect(()=>{if(j)return;let c=0;const b=setInterval(async()=>{const _=await W();G(_),Object.keys(_).length<1&&c<3&&c++,c>=3&&(clearInterval(b),m(!0))},3e3);return()=>clearInterval(b)},[j]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(g,{variant:"h4",component:"h4",children:["Code: ",s]})}),Object.keys(O).length>0&&e(he,{song:O}),j&&r(ce,{children:[e(g,{variant:"h5",component:"h5",children:"Could not get current song. Please try again in a minute."}),e(l,{variant:"contained",color:"primary",onClick:()=>m(!1),children:"Try again"})]}),f?e(t,{item:!0,xs:12,children:e(l,{variant:"contained",color:"primary",onClick:()=>o.push(`/room/${s}/settings`),children:"Settings"})}):"",e(t,{item:!0,xs:12,children:e(l,{variant:"contained",color:"secondary",onClick:P,children:"Leave Room"})})]})}function me(){const o=E(),[s,i]=n.exports.useState(""),[a,C,y]=F(["csrftoken"]),[x,d]=n.exports.useState("");function h(u){i(u.target.value)}function S(){fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a.csrftoken},body:JSON.stringify({code:s})}).then(u=>{u.ok?o.push(`/room/${s}`):d("Room not found.")}).catch(u=>{console.log(u)})}return r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(g,{variant:"h4",component:"h4",children:"Join a Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(H,{error:!!x,label:"Code",placeholder:"Enter a Room Code",value:s,helperText:x,variant:"outlined",onChange:h})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(l,{variant:"contained",color:"primary",onClick:S,children:"Enter Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(l,{variant:"contained",color:"secondary",to:"/",component:I,children:"Back"})})]})}function ge(){const o=E(),{getRoom:s,defaultRoomProps:i}=n.exports.useContext(w),{roomCode:a}=X(),[C,y,x]=F(["csrftoken"]),[d,h]=n.exports.useState(i.guestCanPause),[S,u]=n.exports.useState(i.votesToSkip),[f,v]=n.exports.useState(""),[k,p]=n.exports.useState(!1);function O(m){u(Number(m.target.value))}function G(m){h(m.target.value==="true")}function j(){const m={method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":C.csrftoken},body:JSON.stringify({votes_to_skip:S,guest_can_pause:d,code:a})};fetch("/api/update-room",m).then(P=>{P.ok?(p(!1),v("Room updated successfully!")):(p(!0),v("Error updating room..."))})}return n.exports.useEffect(()=>{async function m(){const P=await s(a);P.response.status!==200&&o.push("/"),h(P.data.guest_can_pause),u(P.data.votes_to_skip)}m()},[]),r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:r(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(oe,{in:f!="",children:k===!0?e(L,{severity:"error",onClose:()=>v(""),children:f}):e(L,{severity:"success",onClose:()=>v(""),children:f})})}),e(t,{item:!0,xs:12,children:e(g,{component:"h4",variant:"h4",children:"Update Room"})}),e(t,{item:!0,xs:12,children:r(N,{component:"fieldset",children:[e(A,{children:e("span",{children:"Guest Control of Playback State"})}),r(U,{row:!0,value:d.toString(),onChange:G,children:[e(q,{value:"true",control:e(B,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(q,{value:"false",control:e(B,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:r(N,{children:[e(H,{required:!0,type:"number",value:S,inputProps:{min:1,style:{textAlign:"center"}},onChange:O}),e(A,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),e(t,{item:!0,xs:12,children:e(l,{color:"primary",variant:"contained",onClick:j,children:"Update Room"})})]})}),e(t,{item:!0,xs:12,children:e(l,{variant:"contained",color:"secondary",onClick:()=>o.push(`/room/${a}`),children:"Go back"})})]})}const T={JOIN:"pages.join",CREATE:"pages.create"};function fe(){const[o,s]=n.exports.useState(T.JOIN);function i(){return"Join page"}function a(){return"Create page"}return n.exports.useEffect(()=>(console.log("ran"),()=>{console.log("unmounted")})),r(t,{container:!0,spacing:1,children:[e(t,{container:!0,item:!0,xs:12,alignItems:"center",justifyContent:"center",children:e(g,{variant:"h4",component:"h4",children:"What is House Party?"})}),e(t,{container:!0,item:!0,xs:12,alignItems:"center",justifyContent:"center",children:e(g,{variant:"body1",children:o===T.JOIN?i():a()})}),e(t,{container:!0,item:!0,xs:12,alignItems:"center",justifyContent:"center",children:e(J,{onClick:()=>{o===T.CREATE?s(T.JOIN):s(T.CREATE)},children:o===T.CREATE?e(ne,{}):e(re,{})})}),e(t,{container:!0,item:!0,xs:12,alignItems:"center",justifyContent:"center",children:e(l,{color:"secondary",variant:"contained",to:"/",component:I,children:"Back"})})]})}function Ce(){return e("div",{className:"center",children:e(le,{children:e(se,{children:r(ae,{children:[e(R,{path:"/",exact:!0,component:de}),e(R,{path:"/join",component:me}),e(R,{path:"/info",component:fe}),e(R,{path:"/create",component:ue}),e(R,{path:"/room/:roomCode",exact:!0,component:pe}),e(R,{path:"/room/:roomCode/settings",component:ge})]})})})})}ie.render(e(M.StrictMode,{children:e(Ce,{})}),document.getElementById("app"));
