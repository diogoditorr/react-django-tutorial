import{j as H,R as D,r as n,u as T,a as G,G as t,T as P,F as w,b as I,c as J,d as _,e as O,f as F,B as p,L as A,g as $,C as z,I as N,P as K,h as Q,S as W,i as Y,k as L,l as Z,A as V,m as ee,n as te,o as R,p as oe}from"./assets/vendor.7327175a.js";const e=H.exports.jsx,s=H.exports.jsxs,b=D.createContext({});function ne(o){const[a,i]=n.exports.useState(""),[r,f]=n.exports.useState({votesToSkip:2,guestCanPause:!0});async function k(C){const u=await fetch("/api/get-room?code="+C);return{data:await u.json(),response:u}}return e(b.Provider,{value:{defaultRoomProps:r,roomCode:a,getRoom:k,setRoomCode:i},children:o.children})}function se(){const o=T(),{setRoomCode:a,defaultRoomProps:i}=n.exports.useContext(b),[r,f,k]=G(["csrftoken"]),[C,u]=n.exports.useState(i.guestCanPause),[d,v]=n.exports.useState(i.votesToSkip);function l(x){v(Number(x.target.value))}function g(x){u(x.target.value==="true")}function y(){const x={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":r.csrftoken},body:JSON.stringify({votes_to_skip:d,guest_can_pause:C})};fetch("/api/create-room",x).then(h=>h.json()).then(h=>{h.code===null?o.push("/"):(a(h.code),o.push("/room/"+h.code))})}return s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(P,{component:"h4",variant:"h4",children:"Create a Room"})}),e(t,{item:!0,xs:12,children:s(w,{component:"fieldset",children:[e(I,{children:e("span",{children:"Guest Control of Playback State"})}),s(J,{row:!0,defaultValue:i.guestCanPause.toString(),onChange:g,children:[e(_,{value:"true",control:e(O,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(_,{value:"false",control:e(O,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:s(w,{children:[e(F,{required:!0,type:"number",defaultValue:d,inputProps:{min:1,style:{textAlign:"center"}},onChange:l}),e(I,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(p,{color:"primary",variant:"contained",onClick:y,children:"Create A Room"})}),e(t,{item:!0,xs:12,children:e(p,{color:"secondary",variant:"contained",to:"/",component:A,children:"Back"})})]})]})}function re(){const{roomCode:o,setRoomCode:a}=n.exports.useContext(b),i=T();return n.exports.useEffect(()=>{console.log("Room Code:",o),o?i.push("/room/"+o):fetch("/api/user-in-room").then(r=>r.json()).then(r=>{r.code!==null&&(a(r.code),i.push("/room/"+r.code))})},[]),s(t,{container:!0,spacing:3,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(P,{variant:"h3",children:"House Party"})}),e(t,{item:!0,xs:12,alignItems:"center",children:s($,{disableElevation:!0,variant:"contained",color:"primary",children:[e(p,{color:"primary",to:"/join",component:A,children:"Join a Room"}),e(p,{color:"secondary",to:"/create",component:A,children:"Create a Room"})]})})]})}function ae(o){function a(){return o.song.time/o.song.duration*100}async function i(){const k=await fetch("/spotify/pause",{method:"PUT",headers:{"Content-Type":"application/json"}});console.log(await k.json())}async function r(){await fetch("/spotify/play",{method:"PUT",headers:{"Content-Type":"application/json"}})}return s(z,{children:[s(t,{container:!0,alignItems:"center",children:[e(t,{item:!0,xs:4,children:e("img",{src:o.song.image_url,height:"100%",width:"100%",alt:""})}),s(t,{item:!0,xs:8,children:[e(P,{component:"h5",variant:"h5",align:"center",children:o.song.title}),e(P,{color:"textSecondary",variant:"subtitle1",align:"center",children:o.song.artist}),s("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e(N,{onClick:()=>o.song.is_playing?i():r(),children:o.song.is_playing?e(K,{}):e(Q,{})}),e(N,{children:e(W,{})})]})]})]}),e(Y,{variant:"determinate",value:a()})]})}function ie(){const o=T(),{roomCode:a}=L(),{setRoomCode:i,getRoom:r}=n.exports.useContext(b),[f,k,C]=G(["csrftoken"]),[u,d]=n.exports.useState(2),[v,l]=n.exports.useState(!1),[g,y]=n.exports.useState(!1),[x,h]=n.exports.useState(!1),[j,B]=n.exports.useState({});function E(){fetch("/api/leave-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":f.csrftoken}}).then(c=>{m(),o.push("/")})}function m(){i("")}async function S(){let c=await fetch("/spotify/is-authenticated");const q=await c.json();if(q.status===!1){c=await fetch("/spotify/get-auth-url");const X=await c.json();window.location.replace(X.url)}h(q.status)}async function M(){const c=await fetch("/spotify/current-song");return c.ok?await c.json():{}}async function U(){const c=await r(a);c.response.status!==200&&(m(),o.push("/")),d(c.data.votes_to_skip),l(c.data.guest_can_pause),y(c.data.is_host),i(a)}return n.exports.useEffect(()=>{U()},[]),n.exports.useEffect(()=>{if(g){S();const c=setInterval(async()=>{B(await M())},3e3);return()=>clearInterval(c)}},[g]),s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:s(P,{variant:"h4",component:"h4",children:["Code: ",a]})}),Object.keys(j).length>0&&e(ae,{song:j}),g?e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"primary",onClick:()=>o.push(`/room/${a}/settings`),children:"Settings"})}):"",e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"secondary",onClick:E,children:"Leave Room"})})]})}function ce(){const o=T(),[a,i]=n.exports.useState(""),[r,f,k]=G(["csrftoken"]),[C,u]=n.exports.useState("");function d(l){i(l.target.value)}function v(){fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":r.csrftoken},body:JSON.stringify({code:a})}).then(l=>{l.ok?o.push(`/room/${a}`):u("Room not found.")}).catch(l=>{console.log(l)})}return s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(P,{variant:"h4",component:"h4",children:"Join a Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(F,{error:!!C,label:"Code",placeholder:"Enter a Room Code",value:a,helperText:C,variant:"outlined",onChange:d})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(p,{variant:"contained",color:"primary",onClick:v,children:"Enter Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(p,{variant:"contained",color:"secondary",to:"/",component:A,children:"Back"})})]})}function le(){const o=T(),{getRoom:a,defaultRoomProps:i}=n.exports.useContext(b),{roomCode:r}=L(),[f,k,C]=G(["csrftoken"]),[u,d]=n.exports.useState(i.guestCanPause),[v,l]=n.exports.useState(i.votesToSkip),[g,y]=n.exports.useState(""),[x,h]=n.exports.useState(!1);function j(m){l(Number(m.target.value))}function B(m){d(m.target.value==="true")}function E(){const m={method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":f.csrftoken},body:JSON.stringify({votes_to_skip:v,guest_can_pause:u,code:r})};fetch("/api/update-room",m).then(S=>{S.ok?(h(!1),y("Room updated successfully!")):(h(!0),y("Error updating room..."))})}return n.exports.useEffect(()=>{async function m(){const S=await a(r);S.response.status!==200&&o.push("/"),d(S.data.guest_can_pause),l(S.data.votes_to_skip)}m()},[]),s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:s(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(Z,{in:g!="",children:x===!0?e(V,{severity:"error",onClose:()=>y(""),children:g}):e(V,{severity:"success",onClose:()=>y(""),children:g})})}),e(t,{item:!0,xs:12,children:e(P,{component:"h4",variant:"h4",children:"Update Room"})}),e(t,{item:!0,xs:12,children:s(w,{component:"fieldset",children:[e(I,{children:e("span",{children:"Guest Control of Playback State"})}),s(J,{row:!0,value:u.toString(),onChange:B,children:[e(_,{value:"true",control:e(O,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(_,{value:"false",control:e(O,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:s(w,{children:[e(F,{required:!0,type:"number",value:v,inputProps:{min:1,style:{textAlign:"center"}},onChange:j}),e(I,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),e(t,{item:!0,xs:12,children:e(p,{color:"primary",variant:"contained",onClick:E,children:"Update Room"})})]})}),e(t,{item:!0,xs:12,children:e(p,{variant:"contained",color:"secondary",onClick:()=>o.push(`/room/${r}`),children:"Go back"})})]})}function ue(){return e("div",{className:"center",children:e(ne,{children:e(ee,{children:s(te,{children:[e(R,{path:"/",exact:!0,component:re}),e(R,{path:"/join",component:ce}),e(R,{path:"/create",component:se}),e(R,{path:"/room/:roomCode",exact:!0,component:ie}),e(R,{path:"/room/:roomCode/settings",component:le})]})})})})}oe.render(e(D.StrictMode,{children:e(ue,{})}),document.getElementById("app"));
