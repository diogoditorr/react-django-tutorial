import{j as H,R as N,r as o,u as P,a as A,G as t,T as y,F as j,b as _,c as q,d as I,e as w,f as F,B as m,L as G,g as L,h as D,C as M,A as O,i as X,S as U,k as S,l as $}from"./assets/vendor.dbbab329.js";const e=H.exports.jsx,n=H.exports.jsxs,T=N.createContext({});function z(r){const[a,i]=o.exports.useState(""),[s,v]=o.exports.useState({votesToSkip:2,guestCanPause:!0});async function R(f){const u=await fetch("/api/get-room?code="+f);return{data:await u.json(),response:u}}return e(T.Provider,{value:{defaultRoomProps:s,roomCode:a,getRoom:R,setRoomCode:i},children:r.children})}function K(){const r=P(),{setRoomCode:a,defaultRoomProps:i}=o.exports.useContext(T),[s,v,R]=A(["csrftoken"]),[f,u]=o.exports.useState(i.guestCanPause),[d,C]=o.exports.useState(i.votesToSkip);function l(k){C(Number(k.target.value))}function g(k){u(k.target.value==="true")}function x(){const k={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrftoken},body:JSON.stringify({votes_to_skip:d,guest_can_pause:f})};fetch("/api/create-room",k).then(h=>h.json()).then(h=>{h.code===null?r.push("/"):(a(h.code),r.push("/room/"+h.code))})}return n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(y,{component:"h4",variant:"h4",children:"Create a Room"})}),e(t,{item:!0,xs:12,children:n(j,{component:"fieldset",children:[e(_,{children:e("span",{children:"Guest Control of Playback State"})}),n(q,{row:!0,defaultValue:i.guestCanPause.toString(),onChange:g,children:[e(I,{value:"true",control:e(w,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(I,{value:"false",control:e(w,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:n(j,{children:[e(F,{required:!0,type:"number",defaultValue:d,inputProps:{min:1,style:{textAlign:"center"}},onChange:l}),e(_,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(m,{color:"primary",variant:"contained",onClick:x,children:"Create A Room"})}),e(t,{item:!0,xs:12,children:e(m,{color:"secondary",variant:"contained",to:"/",component:G,children:"Back"})})]})]})}function Q(){const{roomCode:r,setRoomCode:a}=o.exports.useContext(T),i=P();return o.exports.useEffect(()=>{console.log("Room Code:",r),r?i.push("/room/"+r):fetch("/api/user-in-room").then(s=>s.json()).then(s=>{s.code!==null&&(a(s.code),i.push("/room/"+s.code))})},[]),n(t,{container:!0,spacing:3,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(y,{variant:"h3",children:"House Party"})}),e(t,{item:!0,xs:12,alignItems:"center",children:n(L,{disableElevation:!0,variant:"contained",color:"primary",children:[e(m,{color:"primary",to:"/join",component:G,children:"Join a Room"}),e(m,{color:"secondary",to:"/create",component:G,children:"Create a Room"})]})})]})}function W(){const r=P(),{roomCode:a}=D(),{setRoomCode:i,getRoom:s}=o.exports.useContext(T),[v,R,f]=A(["csrftoken"]),[u,d]=o.exports.useState(2),[C,l]=o.exports.useState(!1),[g,x]=o.exports.useState(!1),[k,h]=o.exports.useState(!1);function B(){fetch("/api/leave-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":v.csrftoken}}).then(c=>{b(),r.push("/")})}function b(){i("")}async function E(){let c=await fetch("/spotify/is-authenticated");const V=await c.json();if(V.status===!1){c=await fetch("/spotify/get-auth-url");const J=await c.json();window.location.replace(J.url)}h(V.status)}async function p(){const c=await s(a);c.response.status!==200&&(b(),r.push("/")),d(c.data.votes_to_skip),l(c.data.guest_can_pause),x(c.data.is_host),i(a),c.data.is_host&&await E()}return o.exports.useEffect(()=>{p()},[]),n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:n(y,{variant:"h4",component:"h4",children:["Code: ",a]})}),e(t,{item:!0,xs:12,children:n(y,{variant:"h6",component:"h6",children:["Votes: ",u]})}),e(t,{item:!0,xs:12,children:n(y,{variant:"h6",component:"h6",children:["Guest Can Pause: ",C?"yes":"no"]})}),e(t,{item:!0,xs:12,children:n(y,{variant:"h6",component:"h6",children:["Host: ",g?"yes":"no"]})}),g?e(t,{item:!0,xs:12,children:e(m,{variant:"contained",color:"primary",onClick:()=>r.push(`/room/${a}/settings`),children:"Settings"})}):"",e(t,{item:!0,xs:12,children:e(m,{variant:"contained",color:"secondary",onClick:B,children:"Leave Room"})})]})}function Y(){const r=P(),[a,i]=o.exports.useState(""),[s,v,R]=A(["csrftoken"]),[f,u]=o.exports.useState("");function d(l){i(l.target.value)}function C(){fetch("/api/join-room",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrftoken},body:JSON.stringify({code:a})}).then(l=>{l.ok?r.push(`/room/${a}`):u("Room not found.")}).catch(l=>{console.log(l)})}return n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,alignItems:"center",children:e(y,{variant:"h4",component:"h4",children:"Join a Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(F,{error:!!f,label:"Code",placeholder:"Enter a Room Code",value:a,helperText:f,variant:"outlined",onChange:d})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(m,{variant:"contained",color:"primary",onClick:C,children:"Enter Room"})}),e(t,{item:!0,xs:12,alignItems:"center",children:e(m,{variant:"contained",color:"secondary",to:"/",component:G,children:"Back"})})]})}function Z(){const r=P(),{getRoom:a,defaultRoomProps:i}=o.exports.useContext(T),{roomCode:s}=D(),[v,R,f]=A(["csrftoken"]),[u,d]=o.exports.useState(i.guestCanPause),[C,l]=o.exports.useState(i.votesToSkip),[g,x]=o.exports.useState(""),[k,h]=o.exports.useState(!1);function B(p){l(Number(p.target.value))}function b(p){d(p.target.value==="true")}function E(){const p={method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":v.csrftoken},body:JSON.stringify({votes_to_skip:C,guest_can_pause:u,code:s})};fetch("/api/update-room",p).then(c=>{c.ok?(h(!1),x("Room updated successfully!")):(h(!0),x("Error updating room..."))})}return o.exports.useEffect(()=>{async function p(){const c=await a(s);c.response.status!==200&&r.push("/"),d(c.data.guest_can_pause),l(c.data.votes_to_skip)}p()},[]),n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:n(t,{container:!0,spacing:1,direction:"column",alignItems:"center",children:[e(t,{item:!0,xs:12,children:e(M,{in:g!="",children:k===!0?e(O,{severity:"error",onClose:()=>x(""),children:g}):e(O,{severity:"success",onClose:()=>x(""),children:g})})}),e(t,{item:!0,xs:12,children:e(y,{component:"h4",variant:"h4",children:"Update Room"})}),e(t,{item:!0,xs:12,children:n(j,{component:"fieldset",children:[e(_,{children:e("span",{children:"Guest Control of Playback State"})}),n(q,{row:!0,value:u.toString(),onChange:b,children:[e(I,{value:"true",control:e(w,{color:"primary"}),label:"Play/Pause",labelPlacement:"bottom"}),e(I,{value:"false",control:e(w,{color:"secondary"}),label:"No control",labelPlacement:"bottom"})]})]})}),e(t,{item:!0,xs:12,children:n(j,{children:[e(F,{required:!0,type:"number",value:C,inputProps:{min:1,style:{textAlign:"center"}},onChange:B}),e(_,{children:e("span",{children:"Votes Required To Skip Song"})})]})}),e(t,{item:!0,xs:12,children:e(m,{color:"primary",variant:"contained",onClick:E,children:"Update Room"})})]})}),e(t,{item:!0,xs:12,children:e(m,{variant:"contained",color:"secondary",onClick:()=>r.push(`/room/${s}`),children:"Go back"})})]})}function ee(){return e("div",{className:"center",children:e(z,{children:e(X,{children:n(U,{children:[e(S,{path:"/",exact:!0,component:Q}),e(S,{path:"/join",component:Y}),e(S,{path:"/create",component:K}),e(S,{path:"/room/:roomCode",exact:!0,component:W}),e(S,{path:"/room/:roomCode/settings",component:Z})]})})})})}$.render(e(N.StrictMode,{children:e(ee,{})}),document.getElementById("app"));
